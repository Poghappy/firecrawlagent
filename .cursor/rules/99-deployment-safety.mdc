---
description: "生产部署安全协议 - 生产环境操作必须获得明确授权"
globs: "**/*"
priority: 2000
---

# 生产部署安全协议

## 🔒 核心原则

**安全第一，谨慎部署** - 所有生产环境操作必须经过用户明确同意

## 环境定义

### 本地开发环境（Local）
- **路径**: `/Users/zhiledeng/Documents/augment-projects/hawaiihub-admin-agent/`
- **权限**: AI 可自由操作
- **数据**: 测试数据，可随意修改
- **风险**: 低

### 生产服务器环境（Production）
- **后台**: `https://hawaiihub.net/admin`
- **宝塔面板**: `https://154.40.47.153:8889/rainy`
- **权限**: 需用户明确授权
- **数据**: 真实用户数据
- **风险**: 高

## ⚠️ 生产部署前置检查

### 必须立即停止并请求授权的操作

当需要以下操作时，必须先获得用户同意：
- ❌ 上传代码到生产服务器
- ❌ 修改生产数据库
- ❌ 修改生产配置文件
- ❌ 重启生产服务
- ❌ 批量删除或修改内容
- ❌ 修改用户权限
- ❌ 变更支付配置

### 授权请求模板

```markdown
## 🚀 生产部署请求

### 📝 操作说明
[简短描述要做什么，1-2句话]

### 🎯 目的与原因
- 为什么需要这个操作？
- 解决什么问题或实现什么功能？

### 📊 对平台运营的影响

#### ✅ 收益
- 具体收益点 1
- 具体收益点 2

#### ⚠️ 风险与弊端
- 可能的风险 1（概率：低/中/高）
- 可能的风险 2

#### 👥 用户体验影响
- 是否需要停机？持续时间？
- 用户是否会感知到变化？

#### ⏱️ 执行时间
- 预计耗时：X 分钟
- 建议执行时间：[凌晨/低峰期/随时]

### 🔄 回滚方案
- 如果出现问题，如何回滚？
- 是否已备份关键数据？

---

**请确认是否授权执行此操作？(是/否/需要更多信息)**
```

## 允许的本地操作（无需授权）

```bash
# ✅ 本地测试和开发
npm install
npm run test
npm run lint
npm run build

# ✅ 本地数据采集测试
npm run scrape:dry-run

# ✅ 查看日志和状态
cat logs/*.log
git status
```

## 需要授权的生产操作

```bash
# ❌ 需要用户授权
scp * user@server:/path/
ssh user@server
mysql -h prod-db
npm run deploy:prod

# ❌ 通过浏览器操作生产后台
- 批量发布内容
- 批量审核/删除
- 修改系统配置
```

## 部署决策矩阵

| 操作类型 | 风险等级 | 需要授权 | 建议时间 | 回滚难度 |
|---------|---------|---------|---------|---------|
| 本地测试 | 低 | ❌ | 随时 | N/A |
| 文档更新 | 低 | ❌ | 随时 | 容易 |
| 配置修改 | 中 | ✅ | 低峰期 | 中等 |
| 代码部署 | 中-高 | ✅ | 低峰期 | 中等 |
| 数据库迁移 | 高 | ✅ | 凌晨 | 困难 |
| 批量操作 | 高 | ✅ | 凌晨 | 困难 |

## AI Agent 行为准则

### ✅ 应该做的
1. 主动说明环境（本地 vs 生产）
2. 优先本地测试
3. 详细记录日志
4. 提供清晰说明
5. 准备回滚方案

### ❌ 不应该做的
1. 未授权部署生产环境
2. 使用模糊说明
3. 隐藏风险
4. 跳过测试
5. 假设授权

## 紧急情况处理

即使是紧急情况，也需要：
1. 快速说明：问题描述 + 紧急程度
2. 影响范围：有多少用户受影响？
3. 修复方案：简要说明如何修复
4. 预计时间：多久能修复？
5. 获得授权：等待用户快速确认

## 检查清单

AI Agent 在每次操作前自问：
- [ ] 我正在哪个环境操作？（本地 vs 生产）
- [ ] 这个操作是否会影响生产服务器？
- [ ] 是否需要用户授权？
- [ ] 我是否准备好了完整的部署说明？
- [ ] 我是否清楚回滚方案？
- [ ] 用户是否明确授权？

**如果任何一项答案是"否"或"不确定"，停止操作，向用户请求授权或更多信息。**
