# Firecrawl 实战案例架构图集

> **创建时间**: 2025-10-27
> **用途**: 为PDF电子书提供可视化架构图和流程图
> **技术**: Mermaid图表

---

## 🏗️ 案例 01: 夏威夷新闻采集器架构图

### 系统架构

```mermaid
graph TB
    A[用户请求] --> B[新闻采集器]
    B --> C{选择采集方式}
    C -->|单篇新闻| D[Scrape API]
    C -->|批量新闻| E[Crawl API]
    C -->|搜索新闻| F[Search API]

    D --> G[内容解析器]
    E --> G
    F --> G

    G --> H{数据验证}
    H -->|有效| I[数据存储]
    H -->|无效| J[错误日志]

    I --> K[JSON文件]
    I --> L[Markdown文件]
    I --> M[CSV文件]

    K --> N[数据分析]
    L --> O[人工审核]
    M --> P[Excel导入]

    style A fill:#e1f5ff
    style B fill:#fff3e0
    style G fill:#f3e5f5
    style I fill:#e8f5e9
```

### 数据流程

```mermaid
sequenceDiagram
    participant U as 用户
    participant S as 爬虫脚本
    participant F as Firecrawl API
    participant D as 数据库
    participant C as 缓存

    U->>S: 启动采集任务
    S->>C: 检查缓存

    alt 缓存命中
        C-->>S: 返回缓存数据
    else 缓存未命中
        S->>F: 发送爬取请求
        F->>F: 渲染页面（JS支持）
        F->>F: 提取内容
        F-->>S: 返回Markdown数据
        S->>C: 更新缓存（1小时）
    end

    S->>S: 数据清洗
    S->>S: 格式化
    S->>D: 保存到数据库
    S-->>U: 返回采集结果
```

---

## 🍽️ 案例 02: 华人商家信息采集架构

### 系统架构

```mermaid
graph LR
    A[商家目录页] --> B[Batch Scrape API]
    B --> C[商家详情页 x N]

    C --> D{提取信息}
    D --> E[基本信息]
    D --> F[联系方式]
    D --> G[营业时间]
    D --> H[用户评论]

    E --> I[商家数据库]
    F --> I
    G --> I
    H --> J[情感分析]

    J --> K[评分计算]
    K --> I

    I --> L[API服务]
    L --> M[HawaiiHub前端]

    style A fill:#fff3e0
    style B fill:#e1f5ff
    style I fill:#e8f5e9
    style M fill:#f3e5f5
```

### 数据模型

```mermaid
erDiagram
    RESTAURANT ||--o{ REVIEW : has
    RESTAURANT ||--o{ MENU_ITEM : offers
    RESTAURANT }o--|| CATEGORY : belongs_to
    RESTAURANT }o--|| LOCATION : located_at

    RESTAURANT {
        string id PK
        string name
        string address
        string phone
        string website
        float rating
        json hours
        datetime created_at
    }

    REVIEW {
        string id PK
        string restaurant_id FK
        string author
        int rating
        string content
        datetime date
    }

    MENU_ITEM {
        string id PK
        string restaurant_id FK
        string name
        float price
        string description
    }

    CATEGORY {
        string id PK
        string name
        string description
    }

    LOCATION {
        string id PK
        string area
        float latitude
        float longitude
    }
```

---

## 🏠 案例 03: 租房信息监控系统架构

### 实时监控流程

```mermaid
graph TD
    A[定时任务 Cron] --> B[租房网站爬虫]
    B --> C[Firecrawl Crawl API]

    C --> D[新房源列表]
    D --> E{对比历史数据}

    E -->|新房源| F[标记为NEW]
    E -->|价格变动| G[标记为PRICE_CHANGE]
    E -->|已下架| H[标记为REMOVED]
    E -->|无变化| I[更新时间戳]

    F --> J[发送通知]
    G --> J
    H --> K[归档数据]

    J --> L[邮件通知]
    J --> M[Telegram Bot]
    J --> N[HawaiiHub App推送]

    I --> O[数据库更新]
    F --> O
    G --> O

    style A fill:#fff3e0
    style J fill:#ffebee
    style O fill:#e8f5e9
```

### Change Tracking机制

```mermaid
sequenceDiagram
    participant C as Cron任务
    participant S as 爬虫服务
    participant F as Firecrawl API
    participant D as 数据库
    participant N as 通知服务

    loop 每小时执行
        C->>S: 触发爬取任务
        S->>F: 请求爬取（enableChangeTracking=true）
        F->>F: 爬取页面
        F->>F: 与上次快照对比
        F-->>S: 返回变更内容

        alt 有新内容
            S->>D: 查询历史记录
            D-->>S: 返回对比结果
            S->>S: 计算价格变动
            S->>N: 发送通知
            N->>N: 用户A: 新房源提醒
            N->>N: 用户B: 降价提醒
        end

        S->>D: 更新数据库
    end
```

---

## 🤖 案例 11: 智能问答系统架构（RAG）

### RAG系统架构

```mermaid
graph TB
    A[用户问题] --> B[问题预处理]
    B --> C[向量化]
    C --> D[向量数据库 Pinecone]

    D --> E[检索Top-K相关文档]
    E --> F[重排序 Reranking]

    F --> G[构建Prompt]
    A --> G

    G --> H[LLM GPT-4]
    H --> I[生成答案]

    I --> J{答案质量检查}
    J -->|优质| K[返回用户]
    J -->|需改进| L[反馈循环]

    L --> M[Fine-tuning数据]
    M --> H

    subgraph 数据源
        N[新闻文章] --> O[Firecrawl采集]
        P[商家信息] --> O
        Q[社区帖子] --> O
        O --> R[文档切片]
        R --> S[向量化]
        S --> D
    end

    style A fill:#e1f5ff
    style H fill:#fff3e0
    style D fill:#f3e5f5
    style K fill:#e8f5e9
```

### 数据处理流程

```mermaid
flowchart LR
    A[原始网页] --> B[Firecrawl Scrape]
    B --> C[Markdown内容]

    C --> D{文档类型}
    D -->|新闻| E[新闻解析器]
    D -->|商家| F[商家解析器]
    D -->|其他| G[通用解析器]

    E --> H[文档切片 512 tokens]
    F --> H
    G --> H

    H --> I[生成Embedding]
    I --> J[Pinecone存储]

    J --> K[索引优化]
    K --> L[RAG检索]

    style B fill:#fff3e0
    style I fill:#e1f5ff
    style J fill:#f3e5f5
```

---

## 🏢 案例 15: HawaiiHub完整数据平台架构

### 微服务架构

```mermaid
graph TB
    subgraph 用户层
        A[Web前端 Next.js]
        B[移动端 React Native]
        C[管理后台]
    end

    subgraph API网关
        D[Nginx负载均衡]
        E[API Gateway]
    end

    subgraph 服务层
        F[用户服务]
        G[商家服务]
        H[新闻服务]
        I[租房服务]
        J[搜索服务]
        K[推荐服务]
    end

    subgraph 数据采集层
        L[新闻爬虫]
        M[商家爬虫]
        N[租房爬虫]
        O[Firecrawl API]
    end

    subgraph 数据存储
        P[(PostgreSQL 主库)]
        Q[(Redis 缓存)]
        R[(Elasticsearch 搜索)]
        S[(Pinecone 向量)]
    end

    A --> D
    B --> D
    C --> D

    D --> E
    E --> F
    E --> G
    E --> H
    E --> I
    E --> J
    E --> K

    L --> O
    M --> O
    N --> O

    O --> P
    F --> P
    G --> P
    H --> P
    I --> P

    F --> Q
    G --> Q
    H --> Q

    J --> R
    K --> S

    style A fill:#e1f5ff
    style O fill:#fff3e0
    style P fill:#e8f5e9
    style S fill:#f3e5f5
```

### 数据流转

```mermaid
sequenceDiagram
    participant U as 用户
    participant W as Web前端
    participant G as API Gateway
    participant S as 商家服务
    participant C as 爬虫服务
    participant F as Firecrawl
    participant D as 数据库
    participant R as Redis

    U->>W: 搜索"火奴鲁鲁中餐"
    W->>G: GET /api/restaurants?q=中餐
    G->>S: 转发请求

    S->>R: 检查缓存
    alt 缓存命中
        R-->>S: 返回缓存结果
    else 缓存未命中
        S->>D: 查询数据库
        D-->>S: 返回结果
        S->>R: 更新缓存（10分钟）
    end

    S-->>G: 返回商家列表
    G-->>W: 返回JSON
    W-->>U: 展示结果

    Note over C,F: 后台定时任务（每日凌晨2点）
    C->>F: 批量爬取商家信息
    F-->>C: 返回Markdown数据
    C->>C: 数据清洗和验证
    C->>D: 更新数据库
    C->>R: 清空相关缓存
```

---

## 📊 技术栈总览

```mermaid
graph LR
    subgraph 前端
        A[Next.js 14]
        B[React Native]
        C[TailwindCSS]
    end

    subgraph 后端
        D[Python 3.11]
        E[FastAPI]
        F[Celery]
    end

    subgraph 数据采集
        G[Firecrawl API]
        H[Playwright]
    end

    subgraph 数据存储
        I[PostgreSQL]
        J[Redis]
        K[Elasticsearch]
        L[Pinecone]
    end

    subgraph AI/ML
        M[GPT-4]
        N[Gemini Pro]
        O[OpenAI Embeddings]
    end

    subgraph 部署
        P[Vercel]
        Q[Railway]
        R[Docker]
    end

    A --> E
    B --> E
    E --> D
    D --> G
    D --> F

    E --> I
    E --> J
    E --> K

    E --> M
    E --> N
    E --> O
    O --> L

    A --> P
    E --> Q
    F --> R
```

---

## 🎯 性能指标

### 系统性能对比

```mermaid
gantt
    title Firecrawl vs 传统爬虫性能对比
    dateFormat X
    axisFormat %s

    section 响应时间
    传统爬虫          :0, 5
    Firecrawl         :0, 1

    section 成功率
    传统爬虫          :0, 7
    Firecrawl         :0, 9.5

    section 开发时间
    传统爬虫          :0, 10
    Firecrawl         :0, 2
```

### 成本分析

| 方案      | 开发成本 | 运维成本   | 月度API费用 | 总成本（首年） |
| --------- | -------- | ---------- | ----------- | -------------- |
| 传统爬虫  | $5,000   | $800/月    | $0          | $14,600        |
| Firecrawl | $500     | $100/月    | $200/月     | $4,100         |
| **节省**  | **-90%** | **-87.5%** | +$200       | **-71.9%**     |

---

## 📈 数据增长趋势

```mermaid
xychart-beta
    title "HawaiiHub 数据增长（2025年预测）"
    x-axis [1月, 2月, 3月, 4月, 5月, 6月, 7月, 8月, 9月, 10月, 11月, 12月]
    y-axis "数据量（千条）" 0 --> 100
    line [5, 8, 12, 18, 25, 35, 45, 58, 70, 82, 92, 100]
    line [2, 5, 8, 12, 18, 25, 33, 42, 52, 63, 75, 88]
```

**说明**：

- 蓝线：新闻文章数量
- 橙线：商家信息数量

---

## 🏆 最佳实践总结

### 开发流程

```mermaid
flowchart TD
    A[需求分析] --> B{选择Firecrawl端点}
    B -->|单页| C[Scrape API]
    B -->|多页| D[Crawl API]
    B -->|搜索| E[Search API]

    C --> F[编写采集脚本]
    D --> F
    E --> F

    F --> G[数据验证]
    G --> H{质量检查}

    H -->|通过| I[生产部署]
    H -->|失败| J[优化参数]

    J --> F

    I --> K[监控告警]
    K --> L{运行状态}

    L -->|正常| M[持续运行]
    L -->|异常| N[故障排查]

    N --> O[修复问题]
    O --> I

    style A fill:#e1f5ff
    style I fill:#e8f5e9
    style K fill:#fff3e0
```

---

**文档版本**: v1.0
**最后更新**: 2025-10-27
**维护团队**: HawaiiHub AI Team
